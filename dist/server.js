!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=require("express-msteams-host")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("botbuilder")},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(5),r=n(6),s=n(7),i=n(8),c=n(0),a=n(1)("msteams");a("Initializing Microsoft Teams Express hosted App..."),n(9).config();const u=n(10),d=o();t.app=d;const l=process.env.port||process.env.PORT||3007;d.use(o.json({verify:(e,t,n,o)=>{e.rawBody=n.toString()}})),d.use(o.urlencoded({extended:!0})),d.set("views",s.join(__dirname,"/")),d.use(i("tiny")),d.use("/scripts",o.static(s.join(__dirname,"web/scripts"))),d.use("/assets",o.static(s.join(__dirname,"web/assets"))),d.use(c.MsTeamsApiRouter(u)),console.log("asdsdhf sh lfkls hfl ask"),d.use("/",o.static(s.join(__dirname,"web/"),{index:"index.html"})),d.set("port",l);const f=r.createServer(d).listen(l,()=>{a(`Server running on ${l}`)});t.server=f},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),t.nonce={},o(n(11)),o(n(12)),o(n(17)),o(n(19))},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);let s=class{};s=o([r.PreventIframe("/cdTest05Tab/index.html"),r.PreventIframe("/cdTest05Tab/config.html"),r.PreventIframe("/cdTest05Tab/remove.html")],s),t.CdTest05Tab=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,c)}a((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(1),c=n(2),a=n(13),u=n(15),d=n(16),l=i("msteams");let f=class{constructor(e){this.activityProc=new d.TeamsActivityProcessor,this._cdTest05MessageExtension=new u.default,this.conversationState=e,this.dialogState=e.createProperty("dialogState"),this.activityProc.messageActivityHandler={onMessage:e=>r(this,void 0,void 0,function*(){const t=d.TeamsContext.from(e);switch(e.activity.type){case c.ActivityTypes.Message:const n=t?t.getActivityTextWithoutMentions().toLowerCase():e.activity.text;if(n.startsWith("hello"))return void(yield e.sendActivity("Oh, hello to you as well!"));n.startsWith("help")||(yield e.sendActivity("I'm terribly sorry, but my master hasn't trained me to do anything yet..."));break;case c.ActivityTypes.ConversationUpdate:if(l("Conversation update"),e.activity.membersAdded&&0!==e.activity.membersAdded.length)for(const t in e.activity.membersAdded)if(e.activity.membersAdded[t].id!==e.activity.recipient.id){const t=c.CardFactory.adaptiveCard(a.default);yield e.sendActivity({attachments:[t]})}}return this.conversationState.saveChanges(e)})},this.activityProc.messageReactionActivityHandler={onMessageReaction:e=>r(this,void 0,void 0,function*(){const t=e.activity.reactionsAdded;t&&t[0]&&(yield e.sendActivity({textFormat:"xml",text:`That was an interesting reaction (<b>${t[0].type}</b>)`}))})}}onTurn(e){return r(this,void 0,void 0,function*(){yield this.activityProc.processIncomingActivity(e)})}};o([s.MessageExtensionDeclaration("cdTest05MessageExtension")],f.prototype,"_cdTest05MessageExtension",void 0),f=o([s.BotDeclaration("/api/messages",new c.MemoryStorage,process.env.MICROSOFT_APP_ID,process.env.MICROSOFT_APP_PASSWORD),s.PreventIframe("/cdTest05Bot/asdasdasd.html")],f),t.CdTest05Bot=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(14);t.default={WelcomeCard:o}},function(e){e.exports={$schema:"http://adaptivecards.io/schemas/adaptive-card.json",type:"AdaptiveCard",version:"1.0",body:[{type:"Image",url:"https://cdtest05.azurewebsites.net/assets/icon.png",size:"stretch"},{type:"TextBlock",spacing:"medium",size:"default",weight:"bolder",text:"Welcome to cd test 05",wrap:!0,maxLines:0},{type:"TextBlock",size:"default",isSubtle:"yes",text:"Hello, nice to meet you!",wrap:!0,maxLines:0}],actions:[{type:"Action.OpenUrl",title:"Learn more about Yo Teams",url:"https://aka.ms/yoteams"},{type:"Action.OpenUrl",title:"cd test 05",url:"https://cdtest05.azurewebsites.net"}]}},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,c)}a((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0),c=n(2),a=s("msteams");let u=class{onQuery(e,t){return r(this,void 0,void 0,function*(){const e=c.CardFactory.heroCard("Test","Test",[`https://${process.env.HOSTNAME}/assets/icon.png`]);return t.parameters&&t.parameters[0]&&"initialRun"===t.parameters[0].name?Promise.resolve({type:"result",attachmentLayout:"grid",attachments:[e]}):Promise.resolve({type:"result",attachmentLayout:"list",attachments:[e]})})}onQuerySettingsUrl(e){return r(this,void 0,void 0,function*(){return Promise.resolve({title:"cd test 05 Message Extension Configuration",value:`https://${process.env.HOSTNAME}/cdTest05MessageExtension/config.html`})})}onSettings(e){return r(this,void 0,void 0,function*(){const t=e.activity.value.state;return a(`New setting: ${t}`),Promise.resolve()})}};u=o([i.PreventIframe("/cdTest05MessageExtension/config.html")],u),t.default=u},function(e,t){e.exports=require("botbuilder-teams")},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i};Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),s=n(18);let i=class{constructor(){}requestHandler(e,t,n){const o=e.body,i={type:r.ActivityTypes.Message},c=process.env.SECURITY_TOKEN;if(c&&c.length>0){const t=e.headers.authorization,n=Buffer.from(e.rawBody,"utf8"),r="HMAC "+s.createHmac("sha256",new Buffer(c,"base64")).update(n).digest("base64");i.text=r===t?`Echo ${o.text}`:"Error: message sender cannot be verified"}else i.text="Error: outgoing webhook is not configured with a security token";t.send(JSON.stringify(i))}};i=o([n(0).OutgoingWebhookDeclaration("/api/webhook")],i),t.CdTest05OutgoingWebhook=i},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var r,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,n,i):r(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i};Object.defineProperty(t,"__esModule",{value:!0});const r=n(20),s=n(0),i=n(21),c=n(1)("msteams");let a=class{constructor(){this.connectors=new i("connectors",!0,!1)}Connect(e){"myAppsState"===e.body.state&&this.connectors.push("/connectors[]",{appType:e.body.appType,color:e.body.color,existing:!0,groupName:e.body.groupName,user:e.body.user,webhookUrl:e.body.webhookUrl})}Ping(e){try{this.connectors.push("/connectors",this.connectors.getData("/connectors").filter(e=>e.existing))}catch(e){if(e.name&&"DataError"===e.name)return[];throw e}return this.connectors.getData("/connectors").map((e,t)=>new Promise((n,o)=>{const s={title:"Sample Connector",text:"This is a sample Office 365 Connector",sections:[{activityTitle:"Ping",activityText:"Sample ping ",activityImage:`https://${process.env.HOSTNAME}/assets/icon.png`,facts:[{name:"Generator",value:"teams"},{name:"Created by",value:e.user}]}],potentialAction:[{"@context":"http://schema.org","@type":"ViewAction",name:"Yo Teams",target:["http://aka.ms/yoteams"]}]};c(`Sending card to ${e.webhookUrl}`),r({method:"POST",uri:decodeURI(e.webhookUrl),headers:{"content-type":"application/json"},body:JSON.stringify(s)},(e,r,s)=>{c(`Response from Connector endpoint is: ${r.statusCode}`),e?o(e):(410===r.statusCode&&this.connectors.push(`/connectors[${t}]/existing`,!1),n())})}))}};a=o([s.ConnectorDeclaration("/api/connector/connect","/api/connector/ping"),s.PreventIframe("/cdTest05Connector/config.html")],a),t.CdTest05Connector=a},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("node-json-db")}]);
//# sourceMappingURL=server.js.map